<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: grid.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: grid.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { TILE_WIDTH, TILE_HEIGHT, gridOrigin } from "./constants.js";

/**
 * 다이아몬드 모양의 격자 꼭짓점 반환
 * @param {number} x - Center x coordinate
 * @param {number} y - Center y coordinate
 * @returns {Phaser.Math.Vector2[]} Array of 4 points representing the diamond
 */
export function diamondPoints(x, y) {
  return diamondPointsScaled(x, y);
}

/**
 * 크기가 조정된 다이아몬드 꼭짓점 반환
 * @param {number} x - Center x coordinate
 * @param {number} y - Center y coordinate
 * @param {number} [width=TILE_WIDTH] - Width of the diamond
 * @param {number} [height=TILE_HEIGHT] - Height of the diamond
 * @returns {Phaser.Math.Vector2[]} Array of 4 points representing the diamond
 */
export function diamondPointsScaled(x, y, width = TILE_WIDTH, height = TILE_HEIGHT) {
  return [
    new Phaser.Math.Vector2(x, y - height / 2),
    new Phaser.Math.Vector2(x + width / 2, y),
    new Phaser.Math.Vector2(x, y + height / 2),
    new Phaser.Math.Vector2(x - width / 2, y),
  ];
}

/**
 * 그리드 좌표를 화면 좌표로 변환
 * @param {number} col - Grid column index
 * @param {number} row - Grid row index
 * @returns {{x: number, y: number}} Screen coordinates
 */
export function gridToScreen(col, row) {
  return {
    x: gridOrigin.x + (col - row) * (TILE_WIDTH / 2),
    y: gridOrigin.y + (col + row) * (TILE_HEIGHT / 2),
  };
}

// 재사용 가능한 폴리곤 객체 (성능 최적화)
const reusablePolygon = new Phaser.Geom.Polygon();

/**
 * 화면 좌표를 그리드 좌표로 변환 (반올림)
 * @param {number} x - Screen x coordinate
 * @param {number} y - Screen y coordinate
 * @returns {{col: number, row: number}|null} Grid coordinates or null if invalid
 */
export function screenToGrid(x, y) {
  const grid = screenToGridFloat(x, y);
  const col = Math.round(grid.col);
  const row = Math.round(grid.row);

  const world = gridToScreen(col, row);
  const diamond = diamondPoints(world.x, world.y);

  reusablePolygon.setTo(diamond);

  if (!Phaser.Geom.Polygon.Contains(reusablePolygon, x, y)) {
    return null;
  }
  return { col, row };
}

/**
 * 화면 좌표를 그리드 좌표로 변환 (소수점)
 * @param {number} x - Screen x coordinate
 * @param {number} y - Screen y coordinate
 * @returns {{col: number, row: number}} Floating point grid coordinates
 */
export function screenToGridFloat(x, y) {
  const cx = x - gridOrigin.x;
  const cy = y - gridOrigin.y;
  const col = (cx / (TILE_WIDTH / 2) + cy / (TILE_HEIGHT / 2)) / 2;
  const row = (cy / (TILE_HEIGHT / 2) - cx / (TILE_WIDTH / 2)) / 2;
  return { col, row };
}

/**
 * 배치할 타일의 기준점(좌상단) 계산
 * @param {number} anchorCol - Anchor column
 * @param {number} anchorRow - Anchor row
 * @param {number} [gridWidth=1] - Width of the tile in grid cells
 * @param {number} [gridHeight=1] - Height of the tile in grid cells
 * @returns {{baseCol: number, baseRow: number}} Base grid coordinates
 */
export function getPlacementBase(anchorCol, anchorRow, gridWidth = 1, gridHeight = 1) {
  const safeWidth = Math.max(1, gridWidth);
  const safeHeight = Math.max(1, gridHeight);
  const baseRow = anchorRow - (safeHeight - 1);
  const baseCol = anchorCol - Math.round((safeWidth - 1) / 2);
  return { baseCol, baseRow };
}

/**
 * 카메라 뷰포트 내 보이는 그리드 범위 계산
 * @param {Phaser.Cameras.Scene2D.Camera} camera - The camera instance
 * @param {number} [padding=0] - Padding around the viewport
 * @returns {{minCol: number, maxCol: number, minRow: number, maxRow: number}} Visible grid bounds
 */
export function getVisibleBounds(camera, padding = 0) {
  const view = camera.worldView;
  const corners = [
    { x: view.left, y: view.top },
    { x: view.right, y: view.top },
    { x: view.right, y: view.bottom },
    { x: view.left, y: view.bottom },
  ];
  const cols = [];
  const rows = [];
  corners.forEach((corner) => {
    const grid = screenToGridFloat(corner.x, corner.y);
    cols.push(grid.col);
    rows.push(grid.row);
  });

  const minCol = Math.floor(Math.min(...cols)) - padding;
  const maxCol = Math.ceil(Math.max(...cols)) + padding;
  const minRow = Math.floor(Math.min(...rows)) - padding;
  const maxRow = Math.ceil(Math.max(...rows)) + padding;
  return { minCol, maxCol, minRow, maxRow };
}

/**
 * 그리드 좌표가 범위 내에 있는지 확인
 * @param {{col: number, row: number}} grid - Grid coordinates to check
 * @param {{minCol: number, maxCol: number, minRow: number, maxRow: number}} bounds - Bounds to check against
 * @returns {boolean} True if within bounds
 */
export function isWithinBounds(grid, bounds) {
  return (
    grid.col >= bounds.minCol &amp;&amp;
    grid.col &lt;= bounds.maxCol &amp;&amp;
    grid.row >= bounds.minRow &amp;&amp;
    grid.row &lt;= bounds.maxRow
  );
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#Calibrator">Calibrator</a></li><li><a href="global.html#DB_NAME">DB_NAME</a></li><li><a href="global.html#GRID_BUFFER">GRID_BUFFER</a></li><li><a href="global.html#TILES_PER_PAGE">TILES_PER_PAGE</a></li><li><a href="global.html#TILE_HEIGHT">TILE_HEIGHT</a></li><li><a href="global.html#TILE_WIDTH">TILE_WIDTH</a></li><li><a href="global.html#WHEEL_SCROLL_FACTOR">WHEEL_SCROLL_FACTOR</a></li><li><a href="global.html#WORLD_BOUNDS">WORLD_BOUNDS</a></li><li><a href="global.html#addTile">addTile</a></li><li><a href="global.html#addTileWithKey">addTileWithKey</a></li><li><a href="global.html#blobToDataURL">blobToDataURL</a></li><li><a href="global.html#clearAll">clearAll</a></li><li><a href="global.html#createCalibrator">createCalibrator</a></li><li><a href="global.html#createScene">createScene</a></li><li><a href="global.html#createTileStore">createTileStore</a></li><li><a href="global.html#deleteCustomTile">deleteCustomTile</a></li><li><a href="global.html#deletePlacement">deletePlacement</a></li><li><a href="global.html#deletePlacements">deletePlacements</a></li><li><a href="global.html#deleteTile">deleteTile</a></li><li><a href="global.html#diamondPoints">diamondPoints</a></li><li><a href="global.html#diamondPointsScaled">diamondPointsScaled</a></li><li><a href="global.html#drawWireGrid">drawWireGrid</a></li><li><a href="global.html#filterAndRenderPalette">filterAndRenderPalette</a></li><li><a href="global.html#filterPalette">filterPalette</a></li><li><a href="global.html#getPlacementBase">getPlacementBase</a></li><li><a href="global.html#getPlacements">getPlacements</a></li><li><a href="global.html#getState">getState</a></li><li><a href="global.html#getTiles">getTiles</a></li><li><a href="global.html#getVisibleBounds">getVisibleBounds</a></li><li><a href="global.html#gridOrigin">gridOrigin</a></li><li><a href="global.html#gridToScreen">gridToScreen</a></li><li><a href="global.html#init">init</a></li><li><a href="global.html#isWithinBounds">isWithinBounds</a></li><li><a href="global.html#loadImageElement">loadImageElement</a></li><li><a href="global.html#loadSavedPlacements">loadSavedPlacements</a></li><li><a href="global.html#preloadScene">preloadScene</a></li><li><a href="global.html#refreshSceneView">refreshSceneView</a></li><li><a href="global.html#renderPalette">renderPalette</a></li><li><a href="global.html#savePlacement">savePlacement</a></li><li><a href="global.html#savePlacements">savePlacements</a></li><li><a href="global.html#screenToGrid">screenToGrid</a></li><li><a href="global.html#screenToGridFloat">screenToGridFloat</a></li><li><a href="global.html#setActiveTile">setActiveTile</a></li><li><a href="global.html#setState">setState</a></li><li><a href="global.html#setupGridSizeToggle">setupGridSizeToggle</a></li><li><a href="global.html#setupPalette">setupPalette</a></li><li><a href="global.html#setupSearch">setupSearch</a></li><li><a href="global.html#startGame">startGame</a></li><li><a href="global.html#syncVisibleTiles">syncVisibleTiles</a></li><li><a href="global.html#updateDepths">updateDepths</a></li><li><a href="global.html#updatePaginationButtons">updatePaginationButtons</a></li><li><a href="global.html#updateScene">updateScene</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Fri Nov 21 2025 23:40:45 GMT+0900 (Korean Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
